<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Members | Kommuna Kollab</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: url('assets/img/2.jpg') center/cover fixed no-repeat;
    }
    /* small utility for round photo border */
    .profile-ring {
      box-shadow: 0 4px 20px rgba(0,0,0,0.6);
      border: 4px solid rgba(255,255,255,0.95);
    }

    /* PDF iframe sizing inside modal */
    .pdf-frame {
      width: 100%;
      height: 80vh;
      border: none;
    }
  </style>
</head>

<body class="text-white min-h-screen">

  <!-- NAV -->
  <nav class="fixed top-0 left-0 w-full bg-black/80 z-50 px-6 py-4 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <div class="w-28 h-12 overflow-hidden">
        <img src="assets/img/Menu.gif" class="w-full h-full object-cover">
      </div>
      <div class="text-lg font-medium pointer-events-none">Kommuna Kollab</div>
    </div>

    <div class="flex items-center gap-4">
      <a href="index.html" class="px-3 py-1 border rounded hover:bg-white hover:text-black transition">Home</a>
    </div>
  </nav>

  <main class="pt-28 px-6 md:px-12 max-w-6xl mx-auto">

    <header class="mb-8 flex items-center justify-between">
      <h1 class="text-4xl md:text-5xl font-semibold">Members</h1>

      <div class="flex items-center gap-4">
        <input id="searchInput" placeholder="Find a member..." class="bg-white/10 backdrop-blur p-2 rounded px-4" />
        <div id="filterInfo" class="text-gray-300 text-sm">Showing all members</div>
      </div>
    </header>

    <!-- Grid -->
    <section id="membersGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8"></section>

    <div class="mt-16 text-center text-gray-400">
      © Kommuna Kollab
    </div>
  </main>

  <!-- PROFILE MODAL -->
  <div id="profileModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-60">
    <div class="bg-white text-black rounded-xl max-w-2xl w-full p-6 relative">
      <button id="closeProfile" class="absolute top-4 right-4 text-xl">✕</button>
      <div class="flex flex-col md:flex-row gap-6 items-center">
        <img id="profileImg" src="" class="w-44 h-44 rounded-full object-cover profile-ring">
        <div>
          <h2 id="profileName" class="text-2xl font-bold mb-2"></h2>
          <div id="profileBadges" class="flex gap-2 mb-4"></div>
          <p id="profileUni" class="text-gray-600 mb-4"></p>
          <div id="profileBio" class="text-gray-700"></div>
          <div class="mt-6 flex gap-3">
            <button id="profileFollow" class="px-4 py-2 bg-yellow-400 text-black rounded">Follow</button>
            <button id="profileBook" class="px-4 py-2 bg-black text-white border rounded">Book</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF MODAL -->
  <div id="pdfModal" class="fixed inset-0 bg-black/90 hidden items-center justify-center z-70">
    <div class="w-full max-w-6xl mx-auto p-6">
      <div class="bg-white rounded-md overflow-hidden">
        <div class="flex items-center justify-between p-4 border-b">
          <div id="pdfTitle" class="font-semibold"></div>
          <div>
            <button id="closePdf" class="px-3 py-1 bg-black text-white rounded">Close</button>
          </div>
        </div>
        <iframe id="pdfFrame" class="pdf-frame" src=""></iframe>
      </div>
    </div>
  </div>

  <!-- Template card (hidden) used by JS to render -->
  <template id="cardTpl">
    <div class="bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-6 flex flex-col items-center text-center">
      <div class="w-36 h-36 rounded-full overflow-hidden profile-ring mb-4">
        <img class="object-cover w-full h-full" />
      </div>

      <div class="font-semibold text-lg" data-name></div>
      <div class="text-gray-300 text-sm mb-4" data-uni></div>

      <div class="flex gap-3 w-full mt-auto">
        <!-- buttons populated by JS -->
      </div>
    </div>
  </template>

  <!-- Script -->
  <script>
    // MEMBERS DATA
    // Edit filenames here if your images / PDFs use different names.
    const members = [
      // CREW (★)
      { id: "ainge", name: "AINGE", role: "crew", img: "assets/img/members/AINGE.png" },
      { id: "brian", name: "BRIAN", role: "crew", img: "assets/img/members/BRIAN.png" },
      { id: "gab", name: "GAB", role: "crew", img: "assets/img/members/GAB.png" },
      { id: "juanmig", name: "JUANMIG", role: "crew", img: "assets/img/members/JUANMIG.png" },
      { id: "vinci", name: "VINCI", role: "crew", img: "assets/img/members/VINCI.png" },

      // PREMIUM (♥) — has pdf
      { id: "crystal", name: "CRYSTAL", role: "premium", img: "assets/img/members/CRYSTAL .jpg", pdf: "assets/pdf/CRYSTAL PORTFOLIO.pdf" },
      { id: "steph", name: "STEPH", role: "premium", img: "assets/img/members/STEPH.jpg", pdf: "assets/pdf/STEPH PORTFOLIO.pdf" },

      // REGULAR (Dan)
      { id: "dan", name: "DAN", role: "member", img: "assets/img/members/DAN.jpg" },
      { id: "keannu", name: "KEANNU", role: "member", img: "assets/img/members/KEANNU.jpg" },
      { id: "kutch", name: "JAIMEE", role: "member", img: "assets/img/members/KUTCH.jpg" }
    ];

    // DOM refs
    const grid = document.getElementById("membersGrid");
    const tpl = document.getElementById("cardTpl");
    const searchInput = document.getElementById("searchInput");

    // Modals
    const profileModal = document.getElementById("profileModal");
    const profileImg = document.getElementById("profileImg");
    const profileName = document.getElementById("profileName");
    const profileUni = document.getElementById("profileUni");
    const profileBadges = document.getElementById("profileBadges");
    const profileBio = document.getElementById("profileBio");
    const profileFollow = document.getElementById("profileFollow");
    const profileBook = document.getElementById("profileBook");
    const closeProfile = document.getElementById("closeProfile");

    const pdfModal = document.getElementById("pdfModal");
    const pdfFrame = document.getElementById("pdfFrame");
    const pdfTitle = document.getElementById("pdfTitle");
    const closePdf = document.getElementById("closePdf");

    // Helper: returns image or placeholder if missing
    function safeImg(src) {
      // We won't check file system from JS — browsers will show broken image if missing.
      // Use placeholder for missing images by checking onerror in <img>.
      return src || "https://via.placeholder.com/400x400?text=No+Image";
    }

    // Follow state persisted in localStorage
    function isFollowing(id) {
      return localStorage.getItem("follow_" + id) === "1";
    }
    function toggleFollow(id, btn) {
      const now = isFollowing(id) ? "0" : "1";
      localStorage.setItem("follow_" + id, now);
      renderFollowBtn(id, btn);
    }
    function renderFollowBtn(id, btn) {
      if (!btn) return;
      if (isFollowing(id)) {
        btn.className = "px-4 py-2 bg-black text-white border rounded";
        btn.innerText = "Following";
      } else {
        btn.className = "px-4 py-2 bg-white text-black rounded";
        btn.innerText = "Follow";
      }
    }

    // Render members into grid
    function renderList(filter = "") {
      grid.innerHTML = "";
      const q = filter.trim().toLowerCase();

      members.forEach(member => {
        if (q && !member.name.toLowerCase().includes(q)) return;

        const clone = tpl.content.cloneNode(true);
        const card = clone.querySelector(".bg-white\\/5");
        const imgWrap = clone.querySelector(".w-36 img");
        const photo = clone.querySelector(".w-36 img");
        const nameEl = clone.querySelector("[data-name]");
        const uniEl = clone.querySelector("[data-uni]");
        const btnContainer = clone.querySelector(".flex.gap-3");

        photo.src = safeImg(member.img);
        photo.onerror = function () { this.src = "https://via.placeholder.com/400x400?text=No+Image"; };
        nameEl.innerText = member.name;
        uniEl.innerText = (member.role === "premium") ? "Premium Member" : (member.role === "crew" ? "Crew" : "");

        // BADGE
        const badgeEl = document.createElement("div");
        badgeEl.className = "absolute -top-3 right-3 text-sm";
        // add badges inside the card using small labels
        const smallBadge = document.createElement("div");
        smallBadge.className = "inline-flex items-center gap-2 text-xs px-2 py-1 rounded-full";
        if (member.role === "premium") {
          smallBadge.classList.add("bg-red-600", "text-white");
          smallBadge.innerHTML = "♥ Premium";
        } else if (member.role === "crew") {
          smallBadge.classList.add("bg-yellow-400", "text-black");
          smallBadge.innerHTML = "★ Crew";
        } else {
          smallBadge.classList.add("bg-white/10", "text-gray-200");
          smallBadge.innerHTML = "Member";
        }

        // Buttons area
        // 1) View Profile (for crew + regular + premium)
        const viewBtn = document.createElement("button");
        viewBtn.className = "flex-1 px-3 py-2 bg-white text-black rounded";
        viewBtn.innerText = "View Profile";
        viewBtn.onclick = () => openProfile(member);

        btnContainer.appendChild(viewBtn);

        // 2) Portfolio (for premium)
        if (member.role === "premium" && member.pdf) {
          const pdfBtn = document.createElement("button");
          pdfBtn.className = "px-3 py-2 bg-black text-white rounded";
          pdfBtn.innerText = "View Portfolio";
          pdfBtn.onclick = () => openPdf(member);
          btnContainer.appendChild(pdfBtn);
        }

        // 3) Follow button
        const followBtn = document.createElement("button");
        followBtn.className = "px-4 py-2 bg-white text-black rounded";
        followBtn.onclick = () => {
          toggleFollow(member.id, followBtn);
        };
        renderFollowBtn(member.id, followBtn);
        btnContainer.appendChild(followBtn);

        // Insert badge into top-right of the card (absolute)
        const wrapper = document.createElement("div");
        wrapper.className = "relative";
        wrapper.appendChild(clone);

        // Append smallBadge inside the card container (top-right)
        // Because of template structure we need to find the real card element after cloning
        // We'll append smallBadge into the card's container using querySelector.
        // Find the last child in grid to attach after we append.

        // Finally append the actual card to grid
        // but we need to grab the actual card element from the clone
        const cardEl = wrapper.querySelector(".bg-white\\/5") || wrapper.querySelector(".bg-white\\/5.backdrop-blur-md");
        // If cardEl not found directly, fallback to first child
        const elToAppend = wrapper.firstElementChild || wrapper;
        // Append smallBadge inside the card (top-right)
        // Use setTimeout 0 to ensure DOM nodes exist (safe)
        grid.appendChild(elToAppend);

        // Find the appended card and add the badge inside it
        const appendedCard = grid.lastElementChild;
        if (appendedCard) {
          appendedCard.style.position = "relative";
          appendedCard.querySelector("[data-name]").insertAdjacentElement("afterend", smallBadge);
        }
      });
    }

    // Open profile modal
    function openProfile(member) {
      profileImg.src = member.img || "https://via.placeholder.com/400x400?text=No+Image";
      profileImg.onerror = function () { this.src = "https://via.placeholder.com/400x400?text=No+Image"; };
      profileName.innerText = member.name;
      profileUni.innerText = (member.role === "crew") ? "Crew Member" : (member.role === "premium" ? "Premium Member" : "Member");
      profileBadges.innerHTML = "";
      if (member.role === "crew") {
        const b = document.createElement("div"); b.className = "px-3 py-1 bg-yellow-400 text-black rounded"; b.innerText = "★ Crew";
        profileBadges.appendChild(b);
      }
      if (member.role === "premium") {
        const b = document.createElement("div"); b.className = "px-3 py-1 bg-red-600 text-white rounded"; b.innerText = "♥ Premium";
        profileBadges.appendChild(b);
      }

      // example bio - you can extend to load real bios later
      profileBio.innerHTML = (member.role === "premium") ? "<strong>Portfolio available</strong>" : "<em>No portfolio uploaded yet.</em>";

      // follow button state in modal
      renderFollowBtn(member.id, profileFollow);
      profileFollow.onclick = () => toggleFollow(member.id, profileFollow);

      // Book action: go to booking page for this member (band)
      profileBook.onclick = () => {
        // Save selected band to localStorage then redirect to booking
        localStorage.setItem("selected_band_id", member.id);
        localStorage.setItem("selected_band_name", member.name);
        window.location.href = "book.html"; // uses your booking page
      };

      profileModal.classList.remove("hidden");
      profileModal.classList.add("flex");
    }

    closeProfile.addEventListener("click", () => {
      profileModal.classList.add("hidden");
      profileModal.classList.remove("flex");
    });

    // Open PDF modal
    function openPdf(member) {
      if (!member.pdf) {
        alert("No portfolio found for this member.");
        return;
      }
      pdfFrame.src = member.pdf; // IMPORTANT: path must be correct relative to project root
      pdfTitle.innerText = member.name + " — Portfolio";
      pdfModal.classList.remove("hidden");
      pdfModal.classList.add("flex");
    }
    closePdf.addEventListener("click", () => {
      pdfModal.classList.add("hidden");
      pdfModal.classList.remove("flex");
      pdfFrame.src = "";
    });

    // Search
    searchInput.addEventListener("input", (e) => {
      renderList(e.target.value);
    });

    // Initial render
    renderList();

  </script>
</body>
</html>
